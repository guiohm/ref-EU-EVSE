
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jungle-Bus Group IRVE OpenData</title>
    <link rel="stylesheet" href="assets/pico.min.css">
    <link rel="stylesheet" href="assets/prism-night.css" id="prism-dark">
    <link rel="stylesheet" href="assets/prism-default.css" id="prism-light">
    <link rel="stylesheet" href="assets/gridjs.css" id="gridjs-light">
    <link rel="stylesheet" href="assets/gridjs-dark.css" id="gridjs-dark">
    <link rel="stylesheet" href="assets/report.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" /> -->
    <script src='assets/sql-wasm-debug.js'></script>
<style>
td.gridjs-td, th.gridjs-th {
    padding: 2px 4px;
}
#wrapper{
    height: 80vh;
}
#input {
    font-family: monospace;
}
</style>
<script>
</script>
</head>
<body>
    <nav class="container report-container report-head">
        <ul>
            <li>
                <hgroup>
                    <h1>Jungle-Bus Group IRVE OpenData</h1>
                </hgroup>
            </li>
        </ul>
        <ul>
            <li>
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-moon"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" /></svg>
                <input type="checkbox" id="dark-light-mode" name="dark-light-mode" role="switch" onchange="change_theme()">
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-sun"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0" /><path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7" /></svg>
            </li>
        </ul>
    </nav>
    <textarea id="input">select * from view_logs where pdc_id is not null limit 3</textarea>
	<button id='submit'>Execute</button>
	<pre id='error'></pre>
    <div id="wrapper"></div>

	<script>
let SQL, buf, db;
(async function(){
    const sqlPromise = initSqlJs({
        locateFile: file => `assets/${file}`
    });
    const dataPromise = fetch("/assets/irve.db").then(res => res.arrayBuffer());
    [SQL, buf] = await Promise.all([sqlPromise, dataPromise])
    db = new SQL.Database(new Uint8Array(buf));
})()

let result, grid, lineCount = null
const gridWrapper = document.getElementById("wrapper")
const inputEl = document.getElementById('input')
const submitBtn = document.getElementById('submit')

function runQuery() {
    submitBtn.disabled = true
    gridWrapper.style.opacity = 0.4
    var sql = inputEl.value;
    result = '', error = '';
    try { result = db.exec(sql); }
    catch (e) { error = e; }
    document.getElementById('error').innerHTML = error;
    if (!grid) {
        console.log("new grid")
        grid = new gridjs.Grid({
            columns: result[0].columns,
            data: result[0].values,
            fixedHeader: true,
            // resizable: true,
            search: true,
            sort: true,
            style:{
                container:{
                'width':'100%',
                'height':'100%'
                },
            },
            width: '100%',
            height: '92%',
        });
    } else {
        grid.destroy()
    }
    lineCount = result[0].values.length

    grid.updateConfig({
        columns: result[0].columns,
        data: result[0].values,
        // height: `${Math.min(900, lineCount * 190)}px`,
    }).render(gridWrapper);

    submitBtn.disabled = false
    gridWrapper.style.opacity = 1
}

document.addEventListener('keydown', (event) => {
    if(event.ctrlKey && event.key == "Enter") {
        runQuery()
    }
});
submitBtn.onclick = runQuery;
	</script>
    <script src="assets/report-themes.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
</body>
</html>